{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import { createFilter } from 'rollup-pluginutils';\nimport matched from 'matched';\n\n\nconst name = 'entry-glob';\nconst entry = '\\0rollup-plugin-entry-glob:single-entry';\nconst suppressed = '\\0rollup-plugin-entry-glob:suppressed';\n\n\nconst sortArray = (arr) => {\n\tconst scriptOrder = ['js', 'mjs', 'jsx', 'es', 'es6', 'ts', 'tsx', 'json'].reverse();\n\tconst assetOrder = ['html', 'htm', 'php', 'css', 'scss', 'sass', 'less', 'png', 'jpg', 'jpeg', 'gif', 'svg'];\n\treturn arr.sort((a, b) => {\n\t\tconst aExt = a.split('.').pop();\n\t\tconst bExt = b.split('.').pop();\n\t\treturn (-scriptOrder.indexOf(aExt) + assetOrder.indexOf(aExt)) - (-scriptOrder.indexOf(bExt) + assetOrder.indexOf(bExt));\n\t});\n};\n\n\nexport default function entryGlob(options) {\n\tconst module = options.fileName\n\t\t? `\\0${options.fileName}`\n\t\t: entry;\n\tconst filter = options.include || options.exclude\n\t\t? createFilter(options.include, options.exclude)\n\t\t: createFilter('**/*');\n\tconst imports = [];\n\tconst chunked = [];\n\tconst exporter = (path) => `export * from ${JSON.stringify(path)};`;\n\tconst importer = (path) => `import ${JSON.stringify(path)};`;\n\toptions.exports = options.exports === undefined || options.exports === true\n\t\t? true\n\t\t: false;\n\n\treturn {\n\t\tname,\n\n\t\toptions(config) {\n\t\t\tconst ret = [];\n\t\t\tconst chunks = {};\n\t\t\tif (config.manualChunks) {\n\t\t\t\tfor (let [ chunk, patterns ] of Object.entries(config.manualChunks)) {\n\t\t\t\t\tchunks[chunk] = [];\n\t\t\t\t\tmatched.sync(patterns, { realpath: true })\n\t\t\t\t\t\t.forEach((path) => {\n\t\t\t\t\t\t\tchunks[chunk].push(path);\n\t\t\t\t\t\t\tchunked.push(path);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (config.input && config.input !== module) {\n\t\t\t\tmatched.sync(config.input, { realpath: true })\n\t\t\t\t\t.forEach((path) => {\n\t\t\t\t\t\tif (!chunked.includes(path)) {\n\t\t\t\t\t\t\tif (filter(path)) imports.push(path);\n\t\t\t\t\t\t\telse ret.push(path);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t}\n\t\t\tconfig.manualChunks = chunks;\n\t\t\tconfig.input = Object.entries(chunks).length\n\t\t\t\t? [module, suppressed, ...sortArray(ret)]\n\t\t\t\t: [module, ...sortArray(ret)];\n\t\t},\n\n\t\tresolveId(id) {\n\t\t\tif (id === module) return module;\n\t\t\tif (id === suppressed) return suppressed;\n\t\t\treturn null;\n\t\t},\n\n\t\tasync load(id) {\n\t\t\tif (id === module) {\n\t\t\t\tif (!imports.length) return Promise.resolve('');\n\t\t\t\treturn Promise.resolve(options.exports\n\t\t\t\t\t? imports.map(exporter).join('\\n')\n\t\t\t\t\t: imports.map(importer).join('\\n'));\n\t\t\t} else if (id === suppressed) {\n\t\t\t\tif (!chunked.length) return Promise.resolve('');\n\t\t\t\treturn Promise.resolve(chunked.map(exporter).join('\\n'));\n\t\t\t}\n\t\t},\n\n\t\tasync generateBundle(config, bundle) {\n\t\t\tconst fileName = `${module.replace('\\0', '_')}.js`;\n\t\t\tbundle[fileName].fileName = `${module.replace('\\0', '')}.js`;\n\t\t\tif (!imports.length) delete bundle[fileName];\n\t\t\t// I'm pretty sure this test is only valid when using\n\t\t\t// rollup-plugin-iife\n\t\t\tif (bundle[fileName] && /^\\s*\\(function\\s*\\(\\)\\s*\\{\\s*\\}\\)\\(\\);\\s*$/g.test(bundle[fileName].code)) delete bundle[fileName];\n\t\t\tdelete bundle[`${suppressed.replace('\\0', '_')}.js`];\n\t\t\t// Get rid of empty bundles when using non-javascript files\n\t\t\t// as entry points\n\t\t\tfor (let [name, chunk] of Object.entries(bundle)) {\n\t\t\t\tif (imports.includes(chunk.facadeModuleId) && chunk.isEntry) {\n\t\t\t\t\tdelete bundle[name];\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t};\n}\n"],"names":["const","createFilter","let"],"mappings":"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"}